FROM golang:1.21-alpine

WORKDIR /app

# Install development tools
RUN apk add --no-cache git && \
    go install github.com/cosmtrek/air@v1.49.0

# Copy initialization script
COPY init-go-mod.sh .
RUN chmod +x init-go-mod.sh

# Copy go.mod and go.sum if they exist
COPY go.mod* ./
COPY go.sum* ./

# Copy source code
COPY . .

# Initialize modules and download dependencies
RUN go mod tidy && \
    go get github.com/gorilla/mux && \
    go get github.com/joho/godotenv && \
    go get github.com/rs/cors && \
    go get github.com/sashabaranov/go-openai && \
    go mod tidy

# Copy Air configuration
COPY .air.toml ./

# Expose port
EXPOSE 8080

# Command to run the application with Air for hot-reloading
CMD ["air", "-c", ".air.toml"] 